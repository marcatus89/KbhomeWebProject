@namespace DoAnTotNghiep.Shared
@using Microsoft.AspNetCore.Components.Authorization
@using DoAnTotNghiep.Services
@inject IJSRuntime JS
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

<AuthorizeView>
    <Authorized>
        <button class="btn btn-outline-secondary btn-sm rounded-pill px-3"
                @onclick="Logout"
                disabled="@_isProcessing">
            <i class="bi bi-box-arrow-right"></i> Đăng xuất
        </button>
    </Authorized>
    <NotAuthorized>
    </NotAuthorized>
</AuthorizeView>

@code {
    private bool _isProcessing = false;

    private async Task Logout()
    {
        if (_isProcessing) return;
        _isProcessing = true;

        try
        {
            try
            {
                await JS.InvokeVoidAsync("localStorage.removeItem", "jwt");
            }
            catch
            {
                
            }

            if (AuthStateProvider is CustomAuthenticationStateProvider custom)
            {
                await custom.LogoutAsync();
            }
            else
            {
                Navigation.NavigateTo("/", forceLoad: true);
            }
        }
        finally
        {
            _isProcessing = false;
            Navigation.NavigateTo("/", forceLoad: true);
        }
    }
}
